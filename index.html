<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>함수형 프로그래밍과 JavaScript ES6+</title>
  </head>
  <body>
    Check the console!

    <script>
      const products = [
        { name: '반팔티', price: 15000 },
        { name: '긴팔티', price: 20000 },
        { name: '핸드폰케이스', price: 15000 },
        { name: '후드티', price: 30000 },
        { name: '바지', price: 25000 }
      ];
    </script>

    <script>
      // map
      const map = (fn, iter) => {
        let res = [];
        for (const p of iter) {
          res.push(fn(p))
        }
        return res;
      }

      const names = (map(p => p.name, products))
      console.log(names);

      const prices = (map(p => p.price, products))
      console.log(prices);
    </script>

    <script>
      // 이터러블 프로토콜을 따른 map의 다형성
      console.log(map(el => el.nodeName, document.querySelectorAll('*')));

      // const it = document.querySelectorAll('*')[Symbol.iterator]();
      // console.log(it.next());
      // console.log(it.next());
      // console.log(it.next());
      // console.log(it.next());
      // console.log(it.next());
      // console.log(it.next());

      function *gen() {
        yield 2;
        yield 3;
        yield 4;
      }

      console.log(map(a => a * a, gen()));

      let m = new Map();
      m.set('a', 10);
      m.set('b', 20);
      console.log(new Map(map(([k, a]) => [k, a * 2], m)));
    </script>

    <script>
      // filter
      const filter = (fn, iter) => {
        const res = [];
        for (const p of iter) {
          if (fn(p)) res.push(p);
        }
        return res;
      }

      // let under20000 = [];
      // for (const p of products) {
      //   if (p.price < 20000) under20000.push(p);
      // }
      // console.log(...under20000);
      //
      // let over20000 = [];
      // for (const p of products) {
      //   if (p.price > 20000) over20000.push(p);
      // }
      // console.log(...over20000);

      console.log(...filter(p => p.price > 20000, products));

      console.log(filter(n => n % 2, [1, 2, 3, 4]));

      console.log(filter(n => n % 2, function *() {
        yield 1;
        yield 2;
        yield 3;
        yield 4;
        yield 5;
      } ()))
    </script>

    <script>
      // reduce
      console.clear();
      const nums = [1, 2, 3, 4, 5];

      let total = 0;
      for (const n of nums) {
        console.log(total, n);
        total += n;
      }
      console.log(total);

      const reduce = (fn, iter, acc) => {
        if (acc === undefined) {
          iter = iter[Symbol.iterator]();
          acc = iter.next().value;
        }

        for (const a of iter) {
          acc = fn(acc, a);
        }
        return acc;
      }

      const add = (a, b) => a + b;

      console.log(reduce(add, nums, 0));
      console.log(reduce(add, nums));
    </script>

    <script>
      // reduce 2
      console.log(reduce((prev, curr) => prev + curr.price, products, 0));
    </script>
  </body>
</html>
